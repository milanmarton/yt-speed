function initializeSpeedDisplay(){const videoContainer=document.querySelector(".html5-video-container");if(!videoContainer)return;let speedDisplay=document.getElementById("yt-speed-display");if(!speedDisplay){speedDisplay=document.createElement("div");speedDisplay.id="yt-speed-display";videoContainer.appendChild(speedDisplay)}return speedDisplay}let displayElement=null;function ensureDisplay(){if(!displayElement||!document.body.contains(displayElement)){displayElement=initializeSpeedDisplay()}}ensureDisplay();const observer=new MutationObserver(()=>{ensureDisplay()});observer.observe(document.body,{childList:true,subtree:true});let lastUrl=location.href;new MutationObserver(()=>{const currentUrl=location.href;if(currentUrl!==lastUrl){lastUrl=currentUrl;resetSpeed()}}).observe(document,{subtree:true,childList:true});function updateSpeedDisplay(speed){ensureDisplay();if(displayElement){displayElement.textContent=`${speed.toFixed(2)}x`;displayElement.style.opacity="1";if(displayElement.fadeTimeout){clearTimeout(displayElement.fadeTimeout)}displayElement.fadeTimeout=setTimeout(()=>{displayElement.style.opacity="0.3"},2e3)}}function resetSpeed(){const video=document.querySelector("video");if(video){video.playbackRate=1;updateSpeedDisplay(1)}}function changeSpeed(delta){const video=document.querySelector("video");if(video){const newSpeed=Math.max(.25,Math.min(16,video.playbackRate+delta));video.playbackRate=newSpeed;updateSpeedDisplay(newSpeed)}}let pressedKeys=new Set;document.addEventListener("keydown",event=>{if(event.ctrlKey&&!event.shiftKey&&!event.altKey){pressedKeys.add(event.key);if(event.key==="ArrowUp"){if(pressedKeys.has("ArrowDown")){resetSpeed()}else{changeSpeed(.05)}event.preventDefault()}else if(event.key==="ArrowDown"){if(pressedKeys.has("ArrowUp")){resetSpeed()}else{changeSpeed(-.05)}event.preventDefault()}}});document.addEventListener("keyup",event=>{pressedKeys.delete(event.key)});function onNewVideo(){const video=document.querySelector("video");if(video){resetSpeed();video.addEventListener("loadedmetadata",()=>{resetSpeed()})}}const videoObserver=new MutationObserver(()=>{if(document.querySelector("video")){onNewVideo();videoObserver.disconnect()}});videoObserver.observe(document.body,{childList:true,subtree:true});